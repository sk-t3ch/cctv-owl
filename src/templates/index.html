<html>
  <head>
    <title>Coral Edge TPU Streamer</title>
  </head>
  <body>
    <h1>Coral Edge TPU Streamer</h1>
    <img src="{{ url_for('video_feed') }}">
    <div class="selections">
      <div>
        <h3>Model Config</h3>
        <label for="label-select">Choose a Label:</label>
        <select name="labels" id="label-select">
          <option value="person">Person</option>
          <option value="bird">Bird</option>
          <option value="book">Book</option>
          <option value="dog">Dog</option>
          <option value="all">All</option>
        </select>
        <div>
        <input type="range" id="threshold-select" name="threshold"
        min="0" max="100">
        <label for="threshold">Threshold</label>
      </div>
      <div>
        <h3>Tracking</h3>
        <label for="tracking-select">Choose a tracking method</label>
        <select name="tracking" id="tracking-select">
          <option value="target">Target</option>
          <option value="maximise">Maximise</option>
        </select>
      </div>
      <div>
        <h3>Actions</h3>
        <input type="checkbox" id="hoot" name="hoot">
        <label for="hoot">Hoot</label><br>
        <input type="checkbox" id="alertPhone" name="alertPhone">
        <label for="alertPhone">Alert</label><br>
      </div>
      <button onclick="updateConfig()">Update Config</button>
    </div>
    
  </body>
  <style>
    .selections {
    border: 2px dashed blueviolet;
    padding: 5px;
    width: 625px;
    }

  </style>

<script>
async function updateConfig() {
  var trackingSelector = document.getElementById("tracking-select");
  var selectedTracking = trackingSelector.value;
  var labelSelector = document.getElementById("label-select");
  var selectedLabel = labelSelector.value;
  var thresholdSelector = document.getElementById("threshold-select");
  var selectedThreshold = thresholdSelector.value / 100;
  var thresholdSelector = document.getElementById("threshold-select");
  var selectedThreshold = thresholdSelector.value / 100;
  
  var hoot = document.getElementById("hoot");
  var selectedHoot = hoot.checked
  var alertPhone = document.getElementById("alertPhone");
  var selectedAlertPhone = alertPhone.checked

  const config = {
    'selected_label': selectedLabel,
    'selected_threshold': selectedThreshold,
    'alert': selectedAlertPhone,
    'hoot': selectedHoot,
    'tracking': selectedTracking
  }
  console.log("CONFIG: ", config)
  const result = await fetch("{{ url_for('update_config') }}", {
    method: 'POST',
    body: JSON.stringify(config),
    headers: {
      'Content-Type': 'application/json'
    }
  }).then(resp => resp.json())
  console.log(result)
}
</script>
</html>
